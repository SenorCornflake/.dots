#!/bin/sh


# KILL IF STARTED THEN RESTART
# Keybinding daemon
pidof sxhkd && killall sxhkd
sxhkd &
# Notification daemon
pidof dunst && killall dunst
dunst &

# START IF NOT STARTED
# Update interval
pidof /bin/bash ~/MAIN/scripts/updates.sh || ~/MAIN/scripts/updates.sh &
# Compositor
pidof picom || picom --experimental-backends --shadow-ignore-shaped &
# Polkit
pidof /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 || /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &

# Monitors
xrandr --output VGA-1 --auto --primary --output eDP-1 --auto --right-of VGA-1
bspc monitor VGA-1 -d 1 2 3 4 5 6
bspc monitor eDP-1 -d 7 8 9 0


bspc config top_padding "0"
bspc config bottom_padding "0"
bspc config left_padding "0"
bspc config right_padding "0"
bspc config border_width "2"
bspc config window_gap "15"
bspc config split_ratio 0.50
bspc config borderless_monocle "true"
bspc config gapless_monocle "true"
bspc config automatic_scheme alternate

bspc config focused_border_color "#abb2bf"
bspc config normal_border_color "#353b45"
bspc config active_border_color "#3e4451"
bspc config urgent_border_color "#e06c75"
bspc config presel_feedback_color "#abb2bf"

# Generate plain color background
bg=$(exconman get polybar.1_bg)
convert -size 1920x1080 xc:"$bg" ~/wallpapers/solid.png

# Generate background with dots
bg=$(exconman get polybar.3_bg)
fg=$(exconman get polybar.3_fg)
convert -size 35x35 xc:"$bg" -fill "$fg" -draw "rectangle 17,17 17,17" ~/MAIN/tmp/tiler.png
convert -size 1920x1080 tile:"$HOME/MAIN/tmp/tiler.png" ~/wallpapers/simple-dots.png
rm ~/MAIN/tmp/tiler.png


# bspc rule -a Gimp desktop='^8' state=floating follow=on
# bspc rule -a Chromium desktop='^2'
# bspc rule -a mplayer2 state=floating
# bspc rule -a Kupfer.py focus=on
# bspc rule -a Screenkey manage=off
bspc rule -a Gpick state=floating


# WALLPAPER
wallpaper="/home/a/wallpapers/simple-dots.png"
feh --no-fehbg --bg-fill "$wallpaper"

# Enable nightmode if it was enabled prior to restarting
python ~/MAIN/scripts/nightmode.py

# Some quality of life X settings
xset r rate 250 30 # Keyboard repeat rate and delay
xsetroot -cursor_name left_ptr # change default cursor to pointer

# Polybar
killall polybar
python ~/MAIN/scripts/launch_polybars.py &

for m in $(xrandr --query | grep " connected " | cut -d" " -f1); do
	monitor="$m" polybar -c ~/.config/polybar/config.ini "$m" &
done
